#!/usr/bin/env bash

CONF_DIR="${HOME}/.config/ssh/conf.d"

if [[ ! -d "${CONF_DIR}" ]]; then
  echo "No ssh config files available for writing."
  exit 1
fi

sorted_config_files="$(find "${CONF_DIR}" -type f | grep -v ".gitignore" | sort)"
if [[ ! -z "${sorted_config_files}" ]]; then
  echo "Combining all ssh config files available in ${CONF_DIR}/"
  mkdir -p "${HOME}/.ssh"
  chmod 600 "${HOME}/.ssh"

  cat ${sorted_config_files} > "${HOME}/.ssh/config_combined"
  ln -fs "${HOME}/.ssh/config_combined" "${HOME}/.ssh/config"
  chmod 600 "${HOME}/.ssh/config"
else
  echo "No configuration files to combine."
fi
